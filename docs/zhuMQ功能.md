### 消息队列应用场景
- 流量削峰
- 解耦
- 异步
- 日志分析

### 支持的功能
- 支持多种消息模式
    - PTP
    - PSB
- 支持多种消息获取方式
  - 服务器主动将消息发给 consumer：获取消息及时，但是无法确定 consumer 端的接收速度，可能会把 consumer 的缓冲区打满，导致消息丢失
  - consumer 主动向服务器拉取消息：不需要估计 consumer 的接收速度，但是消息获取不及时，当消息比较少的情况下，需要 consumer 不断轮询服务器是否有信息
- 支持分布式（多副本）（待定）
    - 使用 raft 协议支持分布式
    - fetch 机制
- 使用 ack 确认应答机制
    - ack 机制是用来选择三种模式，三种模式对数据一致性的保证是不一样的，有强一致和弱一致，可通过需要选择，如果需要响应时间短就采用 0 或 1，如果需要可用性强，一致性强就选 -1（三种都支持，kafka有这个机制）
      - ack = -1：当消息同步到大多数节点（写入大多数节点磁盘）才返回成功
      - ack = 0 ：当消息同步到leader节点（写入leader磁盘）上就返回成功
      - ack = 1 ：当消息被leader接收（收到消息就返回）就返回
      - 问题：如果不是强一致，需要想办法将0，1 模式未同步到其他副本节点的消息同步过去（我采用的是 fetch 机制，让副本节点做为 consumer 取 pull leader 上的信息，同步到本地磁盘）
- 持久化磁盘
    - 写入本地磁盘，可读取历史消息，用于日志分析
    - 顺序读写，加快磁盘 IO
    - sstable 加速索引查找
    - sstable 可存放哈希表再次加速
- 分片
    - 将消息分为多个 topic
    - 每个 topic 分为多个 partition
    - 保证每个 partition 的消息是有序的，不保证 topic 有序
    - 每个 partition 存放一个文件（文件太大就需要更换文件写）
- 存储元数据
    - 使用 Zookeeper（具体见Zookeeper.md）
- 负载均衡
    - 通过负载均衡算法平均分担集群压力，将高负载节点的分片转移到低负载的节点
- RPC
    - 采用字节跳动研发的 kitex（具体详见 kitex.md）
